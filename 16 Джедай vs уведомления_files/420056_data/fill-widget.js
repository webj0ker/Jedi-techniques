!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){var i=n(3),s=i.slice,o=i.pluck,a=i.each,r=i.bind,u=i.create,c=i.isList,l=i.isFunction,h=i.isObject;e.exports={createStore:d};var f={version:"2.0.12",enabled:!1,get:function(e,t){var n=this.storage.read(this._namespacePrefix+e);return this._deserialize(n,t)},set:function(e,t){return void 0===t?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each((function(n,i){e.call(t,t._deserialize(n),(i||"").replace(t._namespaceRegexp,""))}))},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return d.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return d(this.storage,this.plugins,e)}};function d(e,t,n){n||(n=""),e&&!c(e)&&(e=[e]),t&&!c(t)&&(t=[t]);var i=n?"__storejs_"+n+"_":"",d=n?new RegExp("^"+i):null;if(!/^[a-zA-Z0-9_\-]*$/.test(n))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var p=u({_namespacePrefix:i,_namespaceRegexp:d,_testStorage:function(e){try{var t="__storejs__test__";e.write(t,t);var n=e.read(t)===t;return e.remove(t),n}catch(e){return!1}},_assignPluginFnProp:function(e,t){var n=this[t];this[t]=function(){var t=s(arguments,0),i=this;function o(){if(n)return a(arguments,(function(e,n){t[n]=e})),n.apply(i,t)}var r=[o].concat(t);return e.apply(i,r)}},_serialize:function(e){return JSON.stringify(e)},_deserialize:function(e,t){if(!e)return t;var n="";try{n=JSON.parse(e)}catch(t){n=e}return void 0!==n?n:t},_addStorage:function(e){this.enabled||this._testStorage(e)&&(this.storage=e,this.enabled=!0)},_addPlugin:function(e){var t=this;if(c(e))a(e,(function(e){t._addPlugin(e)}));else if(!o(this.plugins,(function(t){return e===t}))){if(this.plugins.push(e),!l(e))throw new Error("Plugins must be function values that return objects");var n=e.call(this);if(!h(n))throw new Error("Plugins must return an object of function properties");a(n,(function(n,i){if(!l(n))throw new Error("Bad plugin property: "+i+" from plugin "+e.name+". Plugins should only return functions.");t._assignPluginFnProp(n,i)}))}},addStorage:function(e){!function(){var e="undefined"==typeof console?null:console;e&&(e.warn?e.warn:e.log).apply(e,arguments)}("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(e)}},f,{plugins:[]});return p.raw={},a(p,(function(e,t){l(e)&&(p.raw[t]=r(p,e))})),a(e,(function(e){p._addStorage(e)})),a(t,(function(e){p._addPlugin(e)})),p}},function(e,t,n){var i=n(3).Global;function s(){return i.localStorage}function o(e){return s().getItem(e)}e.exports={name:"localStorage",read:o,write:function(e,t){return s().setItem(e,t)},each:function(e){for(var t=s().length-1;t>=0;t--){var n=s().key(t);e(o(n),n)}},remove:function(e){return s().removeItem(e)},clearAll:function(){return s().clear()}}},function(e,t,n){var i=n(3),s=i.Global,o=i.trim;e.exports={name:"cookieStorage",read:function(e){if(!e||!c(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(a.cookie.replace(new RegExp(t),"$1"))},write:function(e,t){if(!e)return;a.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/"},each:r,remove:u,clearAll:function(){r((function(e,t){u(t)}))}};var a=s.document;function r(e){for(var t=a.cookie.split(/; ?/g),n=t.length-1;n>=0;n--)if(o(t[n])){var i=t[n].split("="),s=unescape(i[0]);e(unescape(i[1]),s)}}function u(e){e&&c(e)&&(a.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function c(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(a.cookie)}},function(e,t,n){(function(t){var n=Object.assign?Object.assign:function(e,t,n,i){for(var s=1;s<arguments.length;s++)r(Object(arguments[s]),(function(t,n){e[n]=t}));return e},i=function(){if(Object.create)return function(e,t,i,s){var o=a(arguments,1);return n.apply(this,[Object.create(e)].concat(o))};{function e(){}return function(t,i,s,o){var r=a(arguments,1);return e.prototype=t,n.apply(this,[new e].concat(r))}}}(),s=String.prototype.trim?function(e){return String.prototype.trim.call(e)}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},o="undefined"!=typeof window?window:t;function a(e,t){return Array.prototype.slice.call(e,t||0)}function r(e,t){u(e,(function(e,n){return t(e,n),!1}))}function u(e,t){if(c(e)){for(var n=0;n<e.length;n++)if(t(e[n],n))return e[n]}else for(var i in e)if(e.hasOwnProperty(i)&&t(e[i],i))return e[i]}function c(e){return null!=e&&"function"!=typeof e&&"number"==typeof e.length}e.exports={assign:n,create:i,trim:s,bind:function(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}},slice:a,each:r,map:function(e,t){var n=c(e)?[]:{};return u(e,(function(e,i){return n[i]=t(e,i),!1})),n},pluck:u,isList:c,isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},isObject:function(e){return e&&"[object Object]"==={}.toString.call(e)},Global:o}}).call(this,n(5))},function(e,t,n){e.exports=n(6)},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t);var s=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ID="0",this.$question=$(t),this.hasListeners()&&(this.update(),$("select",this.$question).on("change",(function(){n.update()})))}var t,n,s;return t=e,(n=[{key:"hasListeners",value:function(){return $('option[value="'.concat(this.ID,'"]'),this.$question).length>0}},{key:"isOther",value:function(){return!!$('option[value="'.concat(this.ID,'"]'),this.$question).is(":selected")}},{key:"update",value:function(){this.isOther()?$(".question__other",this.$question).addClass("in"):$(".question__other",this.$question).removeClass("in")}}])&&i(t.prototype,n),s&&i(t,s),e}();function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ID="0",this.$question=$(t),this.parentClass=[".question-list__item",".question-table__item"],this.hasListeners()&&(this.update(),$("input",this.$question).on("change",(function(){n.update()})),$("textarea",this.$question).on("change",(function(){$('input[value="'.concat(n.ID,'"]'),n.$question).prop("checked",!0).trigger("change"),n.update()})))}var t,n,i;return t=e,(n=[{key:"hasListeners",value:function(){return $(this._getInputSelector(),this.$question).length>0}},{key:"update",value:function(){var e=this;$(this._getInputSelector(),this.$question).each((function(t,n){var i=$(n);i.is(":checked")?(i.closest(e.parentClass.join(", ")).addClass("active"),i.data("lastActive",(new Date).getTime())):(i.closest(e.parentClass.join(", ")).removeClass("active"),i.data("lastActive",null))}))}},{key:"_getInputSelector",value:function(){var e=[];return this.parentClass.forEach((function(t){e.push("".concat(t,' input[type="radio"]')),e.push("".concat(t,' input[type="checkbox"]'))})),e.join(", ")}}])&&o(t.prototype,n),i&&o(t,i),e}();function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.unableSelector='.question__unable-answer  input[type="checkbox"]',this.hasListeners()&&(this.update(),this.getUnableInput().on("change",(function(){n.update()})))}var t,n,i;return t=e,(n=[{key:"getUnableInput",value:function(){return $(this.unableSelector,this.$question)}},{key:"hasListeners",value:function(){return this.getUnableInput(this.$question).length>0}},{key:"update",value:function(){this.getUnableInput().is(":checked")?this.$question.addClass("question--unable"):this.$question.removeClass("question--unable")}}])&&r(t.prototype,n),i&&r(t,i),e}();function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ID="-1",this.$question=$(t),this.hasListeners()&&(this.update(),$("input, select",this.$question).on("change",(function(){n.update()})))}var t,n,i;return t=e,(n=[{key:"hasListeners",value:function(){return $('option[value="'.concat(this.ID,'"], ')+'input[type="checkbox"][value="'.concat(this.ID,'"]'),this.$question).length>0}},{key:"isNothing",value:function(){return!!$('option[value="'.concat(this.ID,'"]'),this.$question).is(":selected")||!!$('input[type="checkbox"][value="'.concat(this.ID,'"]'),this.$question).is(":checked")}},{key:"update",value:function(){this.isNothing()&&($('input[type="checkbox"][value!="'.concat(this.ID,'"]:checked'),this.$question).prop("checked",!1).trigger("change"),$('option[value!="'.concat(this.ID,'"]:selected'),this.$question).prop("selected",!1).trigger("change"))}}])&&c(t.prototype,n),i&&c(t,i),e}();function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var f=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$form=this.$question.closest("form"),this.currentRequest=null,this.lastInput=null,$("input, select, textarea",this.$question).on("change",(function(e){null===n.currentRequest&&n.update()})),$(".form-control",this.$question).on("input",(function(){null===n.currentRequest&&(n.lastInput=new Date,setTimeout((function(){new Date-n.lastInput>=500&&(n.lastInput=null,n.update())}),500))}))}var t,n,i;return t=e,(n=[{key:"update",value:function(){this._loadQuestions().then(this._toggleQuestions)}},{key:"_toggleQuestions",value:function(e){$(".question.question--hiddenable").each((function(t,n){var i=$(n);-1===e.indexOf(parseInt(i.data("id")))?(i.toggleClass("question--hidden",!0),i.find(".question__input-visible").attr("disabled","disabled"),i.find("input, textarea").attr("disabled","disabled")):(i.toggleClass("question--hidden",!1),i.find(".question__input-visible").attr("disabled",!1),i.find("input, textarea").attr("disabled",!1)),$(window).trigger("hidenable-toogle")}))}},{key:"_loadQuestions",value:function(){var e=this,t=$.Deferred();return null!==this.currentRequest&&this.currentRequest.abort(),this.currentRequest=$.ajax({url:this.$form.attr("action"),data:this.$form.serialize()+"&vq",type:"post",cache:!1,dataType:"json",timeout:1e6,error:function(){e.currentRequest=null,t.reject()},success:function(n){e.currentRequest=null,t.resolve(n)}}),t}}])&&h(t.prototype,n),i&&h(t,i),e}();function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var p=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$order=$('[data-role="question-order"]',this.$question),$("select",this.$question).on("change",(function(e){n._add($(e.currentTarget).val())})),$('input[type="checkbox"]',this.$question).on("change",(function(e){n._add([$(e.currentTarget).val()])}))}var t,n,i;return t=e,(n=[{key:"_add",value:function(e){e&&this.$order.val(this.$order.val()+","+e.join(","))}}])&&d(t.prototype,n),i&&d(t,i),e}();function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var m=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$items=this.$question.find(".question-table__item"),this.update(),$("input",this.$question).on("change",(function(){n.update()}))}var t,n,i;return t=e,(n=[{key:"update",value:function(){this.$items.removeClass("prev"),this.$items.filter(".active").prevAll().each((function(e,t){$(t).addClass("prev")}))}}])&&v(t.prototype,n),i&&v(t,i),e}(),g=n(0),w=n.n(g),y=n(1),q=n.n(y),_=n(2),b=n.n(_);function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var C=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cookieStorage=w.a.createStore([b.a]),this.localStorage=w.a.createStore([q.a]),this.cookieStorage&&this.localStorage&&(this.each(this.cookieStorage,(function(e,n){t.sync(t.localStorage,e,n)})),this.each(this.localStorage,(function(e,n){t.sync(t.cookieStorage,e,n)})))}var t,n,i;return t=e,(n=[{key:"each",value:function(e,t){var n=this;try{e.each((function(e,i){-1!==i.indexOf("survey-fill-")&&t.call(n,i,e)}))}catch(e){}}},{key:"sync",value:function(e,t,n){e.set(t,n)}}])&&k(t.prototype,n),i&&k(t,i),e}();function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var T=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$input=this.$question.find("input"),this.kind=this.$question.data("kind"),this.limitMax=this.$question.data("limit-max"),this.isLimited=this.$question.data("is-limited"),this.map=this.$question.find('[data-role="map-container"]').anketologMap({center:{lat:55.76,lng:37.64},zoom:8},{kind:this.kind,limitMax:this.limitMax,isLimited:this.isLimited,draggable:!0,allowModify:!0});try{var i=JSON.parse(this.$input.val());$.each(i,(function(e,t){this.map.addMarker({lat:t.lat,lng:t.lng},!0)}))}catch(e){}this.map.map.addListener("marker:add",(function(e){n.updateInput(e)})),this.map.map.addListener("marker:move",(function(e){n.updateInput(e)})),this.map.map.addListener("marker:remove",(function(e){n.updateInput(e)}))}var t,n,i;return t=e,(n=[{key:"updateInput",value:function(e){var t=[],n=this;$.each(e,(function(e,i){i.location&&i.description&&i.address&&(!n.kind||"any"===n.kind||i.address.hasOwnProperty(n.kind))?t.push({lat:i.location.lat,lng:i.location.lng,text:i.description,address:i.address}):i.setMap(null)})),this.$input.val(JSON.stringify(t))}}])&&x(t.prototype,n),i&&x(t,i),e}();function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var S=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$input=this.$question.find('input[type="file"]'),this.$panel=this.$question.find(".question__panel"),this.$files=this.$question.find(".question-list"),this.$uploadButton=this.$question.find(".button"),this.$uploadButtonText=this.$uploadButton.find("span"),this.uploadTitle=this.$uploadButtonText.text(),this.maxFiles=this.$question.data("maxFiles"),this.is_upload=!1,this.$input.fileupload({dataType:"json",url:this.$input.data("url"),formData:$.extend(window.csrfToken,{question_id:this.$question.data("id")})});var i=this;this.$input.bind("fileuploadsend",(function(e,t){return parseInt(t.total)>0&&parseInt(i.$question.data("max"))>0&&parseInt(t.total)>parseInt(i.$question.data("max"))?(i.$question.data("maxError")?i._showError(i.$question.data("maxError")):i._showError(__("Превышен максимальный размер файла")),!1):!i.is_upload&&(i.is_upload=!0,!0)})),this.$input.bind("fileuploadalways",(function(){i.is_upload=!1})),this.$input.bind("fileuploaddone",(function(e,t){t.result.html&&i.$files.append(t.result.html),i._hideError(),i._togglePanel(),i._toggleButton(),$anketolog.message.approveShow("Файл загружен")})),this.$input.bind("fileuploadfail",(function(e,t){if(t.jqXHR&&t.jqXHR.responseText){var n=JSON.parse(t.jqXHR.responseText);n.error&&i._showError(n.error)}})),this.$input.bind("fileuploadstart",(function(){i._showProgress(0)})),this.$input.bind("fileuploadprogress",(function(e,t){i._showProgress(Math.round(t.loaded/t.total*100))})),this.$input.bind("fileuploadstop",(function(){i._hideProgress()})),this.$question.on("click",'[data-role="question-list__item-remove"]',(function(e){e.preventDefault(),$(e.currentTarget).closest(".question-list__item").remove(),n._togglePanel(),n._toggleButton()}))}var t,n,i;return t=e,(n=[{key:"_showProgress",value:function(e){this.$uploadButtonText.text(e+"%")}},{key:"_hideProgress",value:function(){this.$uploadButtonText.text(this.uploadTitle)}},{key:"_hideError",value:function(){this.$question.removeClass("question--with-error"),this.$question.find(".question__error-message").remove()}},{key:"_showError",value:function(e){this._hideError(),this.$question.addClass("question--with-error"),this.$question.append($('<div class="question__error-message">').append('<i class="icon icon-error"></i>').append(e))}},{key:"_togglePanel",value:function(){this.$panel.toggleClass("hidden",this.$files.find(".question-list__item").length<1)}},{key:"_toggleButton",value:function(){this.$uploadButton.toggle(this.$files.find(".question-list__item").length<this.maxFiles)}}])&&I(t.prototype,n),i&&I(t,i),e}();function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var O=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$images=this.$question.find('[data-role="option-image"]'),this.try=0,this._updateSize()}var t,n,i;return t=e,(n=[{key:"_updateSize",value:function(){var e=this;this.try++,this.$images.each((function(t,n){var i=$(n).closest(n.dataset.container),s=$(n),o=s.find("img");parseInt(n.dataset.widthAnkt)>i.width()?e.try<100&&setTimeout((function(){e._updateSize()}),100+20*e.try):(s.css({width:n.dataset.widthAnkt+"px",height:n.dataset.heightAnkt+"px"}),o&&o.css({width:n.dataset.widthAnkt+"px",height:n.dataset.heightAnkt+"px"}))}))}}])&&j(t.prototype,n),i&&j(t,i),e}();var P=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t);try{new Cleave($('input[type="text"]',this.$question),{phone:!0,phoneRegionCode:"RU"})}catch(e){}};function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var D=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$inputs=this.$question.find("input"),this.$question.sortable({axis:"y",items:".question-list__item",connectWith:".question-list",stop:function(){n._enable()}}),this.$question.find('[data-role="order-up"]').click((function(e){e.preventDefault(),n._moveUp($(e.currentTarget).parents(".question-list__item")),n._enable()})),this.$question.find('[data-role="order-down"]').click((function(e){e.preventDefault(),n._moveDown($(e.currentTarget).parents(".question-list__item")),n._enable()}))}var t,n,i;return t=e,(n=[{key:"_enable",value:function(){this.$inputs.attr("disabled",!1),this.$inputs.trigger("change"),this.$question.addClass("has-changes")}},{key:"_moveUp",value:function(e){var t=e.prev();0!==t.length&&e.insertBefore(t)}},{key:"_moveDown",value:function(e){var t=e.next();0!==t.length&&e.insertAfter(t)}}])&&E(t.prototype,n),i&&E(t,i),e}();function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var L=function(){function e(t){var n=this;A(this,e),this.options={templates:{wrapper:'<div class="{wrapperClass} {multipleClass}"></div>',button:'<div class="{buttonClass}"><div class="{selectedItemsClass}">{selectedItems}</div></div>',selectedItem:'<div class="{selectedItemClass}" data-value="{value}">{label} {remove}</div>',removeItem:'<span class="{removeItemClass}" data-value="{value}"></span>',dropdown:'<div class="{dropdownClass}"></div>',dropdownItem:'<div class="{dropdownItemClass} {active}" data-value="{value}">{label}</div>',placeholder:'<div class="{placeholderClass}">{placeholder}</div>'},classes:{wrapperClass:"survey-select-widget",openClass:"open",buttonClass:"survey-select-widget__button",selectedItemsClass:"survey-select-widget__selected-items",selectedItemClass:"survey-select-widget__selected-item",removeItemClass:"survey-select-widget__selected-remove",dropdownClass:"survey-select-widget__dropdown",dropdownItemClass:"survey-select-widget__dropdown-item",dropdownSearchClass:"survey-select-widget__dropdown-search",placeholderClass:"survey-select-widget__placeholder"}},this.$select=$(t),this.$select.data("select-widget",this),this._isTouch(),this.$body=$("body"),this.$container=this._renderContainer(),this.$button=this._renderButton(),this.$dropdown=this._renderDropdown(),$(window).on("scroll orientationchange resize",(function(){n._positionDropdown()})),this.$body.on("click",(function(e){n._isOpen()&&0===$(e.target).closest(n.$container).length&&0===$(e.target).closest(n.$dropdown).length&&n._closeDropdown()}))}var t,n,i;return t=e,(n=[{key:"_isTouch",value:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}},{key:"_renderDropdown",value:function(){var e=$(this._renderTemplate("dropdown",{}));return this.$body.append(e),this._renderDropdownItems(e),e}},{key:"_renderDropdownItems",value:function(e){var t=this,n=[],i=$("option",this.$select),s=$('<input type="text" class="form-control" placeholder="Поиск вариантов..."/>'),o=$("<div>").addClass(this.options.classes.dropdownSearchClass).append(s);i.length>15&&n.push(o),i.each((function(e,i){if(i.value){var s=$(t._renderTemplate("dropdownItem",{"{label}":i.innerHTML,"{value}":i.value,"{active}":i.selected?"active":""}));n.push(s),s.on("click",(function(e){t._selectOption(e.currentTarget.dataset.value)}))}})),e.append(n);var a=this.$select,r=this.options.classes.dropdownItemClass;return s.on("change input",(function(t){var n=t.target.value,i=[];n.length>0?($("option",a).each((function(e,t){-1!==t.innerHTML.toLowerCase().indexOf(n.toLowerCase())&&i.push(t.value)})),e.find("."+r).each((function(e,t){$(t).toggleClass("hidden",-1===i.indexOf(t.dataset.value))}))):e.find("."+r).removeClass("hidden")})),n}},{key:"_updateDropdownItems",value:function(e){var t=this,n=this.$select.val();e.find("."+this.options.classes.dropdownItemClass).each((function(e,i){var s=$(i);s.removeClass("active"),t.$select.prop("multiple")?n instanceof Array&&-1!==n.indexOf(s.data("value")+"")&&s.addClass("active"):n===s.data("value")+""&&s.addClass("active")}))}},{key:"_renderButton",value:function(){var e=this,t=$(this._renderTemplate("button",{}));return this.$container.append(t),this._renderButtonItems(t),t.on("click",(function(){e._toggleDropdown()})),t}},{key:"_renderButtonItems",value:function(e){var t=this,n=[],i=null;return $("option",this.$select).each((function(e,s){s.value&&s.selected?n.push(t._renderTemplate("selectedItem",{"{label}":s.innerHTML,"{value}":s.value,"{active}":s.selected?"active":"","{remove}":t.$select.prop("multiple")?t._renderTemplate("removeItem",{"{value}":s.value}):""})):s.value||(i=s.innerHTML)})),$("."+this.options.classes.selectedItemsClass,e).html(n.length>0?n.join(""):this._renderTemplate("placeholder",{"{placeholder}":i})),$("."+this.options.classes.removeItemClass,e).on("click",(function(e){e.preventDefault(),e.stopPropagation(),t._unselectOption(e.currentTarget.dataset.value)})),n}},{key:"_renderContainer",value:function(){return this.$select.wrap(this._renderTemplate("wrapper",{"{multipleClass}":this.$select.prop("multiple")?"multiple":""})),this.$select.parent("div")}},{key:"_renderTemplate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.options.templates[e]||"";return $.each(t,(function(e,t){n=n.replace(e,t)})),$.each(this.options.classes,(function(e,t){n=n.replace("{".concat(e,"}"),t)})),n}},{key:"_unselectOption",value:function(e){if(this.$select.prop("multiple")){var t=this.$select.val();if(t instanceof Array){var n=t.indexOf(e);t.splice(n,1),this._updateSelectValue(t)}}}},{key:"_selectOption",value:function(e){var t=this.$select.val();if(this.$select.prop("multiple")){t instanceof Array||(t=[]);var n=t.indexOf(e);-1!==n?t.splice(n,1):t.push(e)}else t=t===e?null:e;this._updateSelectValue(t),this.$select.prop("multiple")||this._closeDropdown()}},{key:"_updateSelectValue",value:function(e){this.$select.val(e).change(),this._updateDropdownItems(this.$dropdown),this._renderButtonItems(this.$button),this._positionDropdown(!0)}},{key:"_positionDropdown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.$container.hasClass(this.options.classes.openClass)||e)&&this.$dropdown.css({left:this.$button.offset().left||0,top:(this.$button.offset().top||0)+this.$button.outerHeight(),width:this.$button.outerWidth()})}},{key:"_toggleDropdown",value:function(){this.$container.toggleClass(this.options.classes.openClass),this.$dropdown.toggleClass(this.options.classes.openClass),this._positionDropdown(!0)}},{key:"_closeDropdown",value:function(){this.$container.removeClass(this.options.classes.openClass),this.$dropdown.removeClass(this.options.classes.openClass),$("."+this.options.classes.dropdownSearchClass+" input").val("").trigger("change")}},{key:"_isOpen",value:function(){return this.$container.hasClass(this.options.classes.openClass)&&this.$dropdown.hasClass(this.options.classes.openClass)}}])&&R(t.prototype,n),i&&R(t,i),e}(),M=function e(t){A(this,e),this.$question=$(t),this.$question.find("select").each((function(e,t){new L(t)}))};function B(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var F=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$wrapper=this.$question.find(".question__wrapper"),this.$panel=this.$question.find(".question__panel"),this.$table=this.$question.find("table"),this.$text=this.$question.find(".question-table__item-text"),this.update(),setTimeout((function(){n.update()}),100),setTimeout((function(){n.$text.each((function(){var e=$("span",this);e.length>0&&$(this).width()<e.width()&&e.css("word-break","break-all")}))}),150),$(window).on("orientationchange resize hidenable-toogle",(function(){n.update()}))}var t,n,i;return t=e,(n=[{key:"update",value:function(){var e=this.$panel.width(),t=this.$table.width();if(e&&t&&!(t<=e||e<=0)){var n=Math.min(t,$(window).width()-30,1200);this.$panel.width(n+5),this.$panel.css("transform","translateX(-50%)"),this.$wrapper.css("marginLeft","50%")}}}])&&B(t.prototype,n),i&&B(t,i),e}();var z=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$container=$(t),this.$form=this.$container.find("form"),this.$modalBody=this.$container.find(".modal-body"),this.$errors=this.$container.find(".errors"),this.$form.on("submit",(function(e){e.preventDefault(),$.ajax({url:n.$form.attr("action"),type:n.$form.attr("method"),data:n.$form.serialize(),dataType:"json",timeout:1e4,cache:!1,beforeSend:function(){n.$errors.empty()},success:function(e){e&&e.message&&n.$modalBody.html("<h3>".concat(e.message,"</h3>"))},error:function(e){var t=JSON.parse(e.responseText);t&&t.errors&&$.each(t.errors,(function(e,t){n.$errors.append('<p class="error">'.concat(t,"</p>"))}))},complete:function(){}})}))};var U=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$container=$(t),this.$form=this.$container.find("form"),this.$modalBody=this.$container.find(".modal-body"),this.$errors=this.$container.find(".errors"),this.$form.on("submit",(function(e){e.preventDefault(),$.ajax({url:n.$form.attr("action"),type:n.$form.attr("method"),data:n.$form.serialize(),dataType:"json",timeout:1e4,cache:!1,beforeSend:function(){n.$errors.empty()},success:function(e){e&&e.message&&n.$modalBody.html("<h3>".concat(e.message,"</h3>"))},error:function(e){var t=JSON.parse(e.responseText);t&&t.errors&&$.each(t.errors,(function(e,t){n.$errors.append('<p class="error">'.concat(t,"</p>"))}))},complete:function(){}})}))};var N=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$images=this.$question.find('[data-role="option-image"][data-image="fancybox"]'),this.$images.fancybox({})};var J=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),$('input[type="radio"]',this.$question).on("click",(function(e){var t=$(e.currentTarget);t.data("lastActive")&&(new Date).getTime()-t.data("lastActive")>250&&t.prop("checked",!1).trigger("change")}))};var H=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t);var n=this.$question.data("language");$("input",this.$question).datetimepicker({useCurrent:!1,showTodayButton:!0,format:__("DD.MM.YYYY"),locale:n})};function Q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var G=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$inputs=this.$question.find('input[type="number"]'),this.$residue=this.$question.find('[data-role="slider-residue"]'),this.max=parseInt(this.$question.data("max")),this.$inputs.each((function(e,t){var i=n;$(t).ionRangeSlider({skin:"big",keyboard:!0,onStart:function(){this.from_max=i.max-i._getTotal()+parseInt($(t).val())},onFinish:function(e){i._updateFromMax(),i._updateResidue()},onChange:function(){i._updateResidue()}})})),this._updateResidue()}var t,n,i;return t=e,(n=[{key:"_updateResidue",value:function(){if(this.$residue){var e=0;this.$inputs.each((function(t,n){e+=parseInt($(n).val())})),this.$residue.text(this.max-e)}}},{key:"_updateFromMax",value:function(e){var t=this;this.$inputs.each((function(e,n){$(n).data("ionRangeSlider").update({from_max:t.max-t._getTotal()+parseInt($(n).val())})}))}},{key:"_getTotal",value:function(){var e=0;return this.$inputs.each((function(t,n){e+=parseInt(n.value)||0})),e}}])&&Q(t.prototype,n),i&&Q(t,i),e}();var X=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$pairs=this.$question.find(".question__pair"),this.$pairs.each((function(){$(".active",this).length>0&&($(this).css("display","block"),$(this).next(".question__pair").css("display","block"))})),$('input[type="radio"]',this.$question).on("click",(function(e){setTimeout((function(){$(e.currentTarget).closest(".question__pair").next(".question__pair").fadeIn(400)}),100)}))};var Y=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$question.hasClass("question--not-multiselect-column")&&$("input",this.$question).on("change",(function(e){var t=$(e.currentTarget);if(t.is(":checked"))if(n.$question.find(".question-mobile").length>0){var i=t.closest(".question-list__item"),s=i.closest(".question-list"),o=s.find(".question-list__item").index(i);s.siblings().each((function(){var e=$(this).find(".question-list__item").get(o);e&&$(e).find("input").prop("checked",!1).trigger("change")}))}else{var a=t.closest("td"),r=a.closest("tr"),u=r.find("td").index(a);r.siblings().each((function(){var e=$(this).find("td").get(u);e&&$(e).find("input").prop("checked",!1).trigger("change")}))}}))};function V(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var W=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.hasListeners()&&(this.update(),$("input",this.$question).on("change",(function(){n.update()})))}var t,n,i;return t=e,(n=[{key:"hasListeners",value:function(){return $('.question__pair--forbidable input[type="radio"]',this.$question).length>0}},{key:"update",value:function(){$('.question__pair--forbidable input[type="radio"]',this.$question).each((function(e,t){var n=$(t);n.is(":checked")&&n.closest(".question__pair--forbidable").addClass("question__pair--unable")}))}}])&&V(t.prototype,n),i&&V(t,i),e}();function Z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var K=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$question=$(t),this.$form=this.$question.closest("form"),this.$confirm=this.$question.find('[data-role="question-confirm"]'),this.$inputs=this.$question.find('[name^="question"]'),this.$radios=this.$question.find('[type="radio"], [type="checkbox"]'),this.$selects=this.$question.find("select"),this.$hiddens=this.$question.find(".question-list__item-simple--hidden"),this.questionid=this.$question.data("qid"),this.stateid=$('[name="state"]').val(),this.store=w.a.createStore([q.a,b.a]),this.currentRequest=null,this.currentUpdate=!1,this.update(!0),this.$confirm.on("click",(function(e){e.preventDefault(),n.hasAnswer()?(n.unlockInput(),n.lockConfirm(),n.lock(),n.save(),n.update(!1),n.currentUpdate=!0,n.$selects.trigger("change"),n.$radios.filter(":checked").trigger("change"),n.currentUpdate=!1):$anketolog.message.errorShow(__("Сначала неободимо дать ответ"))}))}var t,n,i;return t=e,(n=[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!this.isLocked()||e&&this.hasError()?this.lockInput():(this.lockQuestion(),this.unlockInput(),this.lockConfirm())}},{key:"hasError",value:function(){return this.$question.hasClass("question--with-error")}},{key:"hasAnswer",value:function(){return!(!this.$selects.val()||!this.$selects.val().length)||this.$radios.filter(":checked").length>0}},{key:"isLocked",value:function(){return this.getIds()[this.questionid]||!1}},{key:"lock",value:function(){var e=this.getIds();e[this.questionid]=!0,this.setIds(e)}},{key:"save",value:function(){null!==this.currentRequest&&this.currentRequest.abort(),this.currentRequest=$.ajax({url:this.$form.attr("action"),data:this.$form.serialize()+"&vq",type:"post",cache:!1,dataType:"json",timeout:1e6})}},{key:"setIds",value:function(e){this.store.set("question-state-"+this.stateid,e)}},{key:"getIds",value:function(){return this.store.get("question-state-"+this.stateid)||{}}},{key:"lockInput",value:function(){this.$inputs.each((function(e,t){t.setAttribute("name","locked."+t.getAttribute("name"))})),this.$hiddens.each((function(e,t){$(t).hide()}))}},{key:"unlockInput",value:function(){this.$inputs.each((function(e,t){t.setAttribute("name",t.getAttribute("name").replace("locked.",""))})),this.$hiddens.each((function(e,t){$(t).show()}))}},{key:"lockConfirm",value:function(){this.$confirm.attr("disabled","disabled").addClass("disabled"),this.$confirm.find("span").text(this.$confirm.data("disabled-text"))}},{key:"unlockConfirm",value:function(){this.$confirm.attr("disabled",!1).removeClass("disabled")}},{key:"lockQuestion",value:function(){this.$question.addClass("question--locked")}}])&&Z(t.prototype,n),i&&Z(t,i),e}();window.l=console.log,$.fn.fill=function(){$(this).each((function(e,t){var n=$(t);$(".question",n).each((function(e,t){new u(t)})),$(".question.question--free",n).each((function(e,t){})),$(".question.question--freelist",n).each((function(e,t){})),$(".question.question--freematrix",n).each((function(e,t){new N(t),new F(t)})),$(".question.question--select",n).each((function(e,t){new a(t)})),$(".question.question--multiselect",n).each((function(e,t){new a(t),new l(t),new p(t)})),$(".question.question--dropdown",n).each((function(e,t){new M(t),new s(t)})),$(".question.question--multidropdown",n).each((function(e,t){new M(t),new s(t),new l(t),new p(t)})),$(".question.question--matrix",n).each((function(e,t){new a(t),new Y(t),new N(t),new F(t),new J(t)})),$(".question.question--matrix3d",n).each((function(e,t){new M(t),new N(t),new F(t)})),$(".question.question--name",n).each((function(e,t){})),$(".question.question--file",n).each((function(e,t){new S(t)})),$(".question.question--email",n).each((function(e,t){})),$(".question.question--phone",n).each((function(e,t){new P(t)})),$(".question.question--date > .question__wrapper",n).each((function(e,t){new H(t)})),$(".question.question--html",n).each((function(e,t){})),$(".question.question--scale",n).each((function(e,t){new a(t),new F(t),new J(t)})),$(".question.question--order",n).each((function(e,t){new D(t)})),$(".question.question--ratingscale",n).each((function(e,t){new G(t)})),$(".question.question--paircompare",n).each((function(e,t){new a(t),new W(t),new X(t)})),$(".question.question--map",n).each((function(e,t){new T(t)})),$(".question.question--has-listener",n).each((function(e,t){new f(t)})),$(".question.question--scale-stars",n).each((function(e,t){new m(t)})),$(".question.question--with-images",n).each((function(e,t){new O(t)})),$(".question.question--once-answer",n).each((function(e,t){new K(t)}))})),$("#feedback").each((function(e,t){new z(t)})),$("#complaint").each((function(e,t){new U(t)})),$("form input").on("keyup keypress",(function(e){if(13===parseInt(e.keyCode||e.which))return e.preventDefault(),!1})),new C}}]);
!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="sitejs/",n(n.s=37)}([function(t,e,n){var i=n(26)("wks"),o=n(19),r=n(1).Symbol,s="function"==typeof r;(t.exports=function(t){return i[t]||(i[t]=s&&r[t]||(s?r:o)("Symbol."+t))}).store=i},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e,n){var i=n(7);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var r=n(74),s=n(75);function c(t){var e=t.document.getElementsByTagName("title");return e.length>0?w(e[0].innerText).substr(0,255):""}var a={"&amp;":"&","&#038;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'","&#8217;":"’","&#8216;":"‘","&#8211;":"–","&#8212;":"—","&#8230;":"…","&#8220;":"“","&#8221;":"”","&#171;":"«","&#187;":"»"};function u(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)}function l(){return window.navigator.language}e.escapeHtml=function(t){return t.replace(/\&[\w\d\#]{2,5}\;/g,function(t){return a[t]?a[t]:""})},e.IsMobile=u,e.GetLang=l,e.IsMobileiOS=/iPhone|iPad|iPod/i.test(window.navigator.userAgent),e.TCLog=function(t){console.error("tc:",t)},e.LoadServer=function(t){return fetch(t.ServerUrl+"/api/site/settings/"+t.SiteId).then(function(t){return t.json()}).then(function(t){return t.data}).catch(function(t){throw new Error("tc: server settings no load")})},e.LoadSettings=function(t){for(var e=t.document.getElementsByTagName("script"),n=0;n<e.length;n++){var i=e[n];if(i.tagName&&i.hasAttribute("src")){var o=i.getAttribute("src"),r=o.toString().match(/(.+?)\/site.+\?i=(.+?)&x=([0-9]+)*?&/);if(r&&4==r.length&&o.indexOf(s.DOMAIN_ZONE)>0||"localhost"==location.hostname||o.indexOf("172.16.0.188")>0){var c=t.location.href,a=c.indexOf("#tc-c"),u=a>0?parseInt(c.substr(a+5)):null,l=r[1];return 0==l.indexOf("//")&&(l="https://"+l.substr(2)),{SiteId:r[3],WindowName:r[2],ServerUrl:l,Href:c,CommentSelect:u,time:0}}}}return null},e.LoadConfig=function(t,e,n){return p({main:!1,identity:null,url:v(t.document.location.href),title:c(window),visible:null==n||null,comment_class:"",comment_render:function(t){return t.toString()},comment_button_text:"Обсудить",desktop_class:"tolstoycomments-feed",success:function(){},show_classic_desktop:null,show_classic_mobile:null,scroll_border_top:0,scroll_border_bottom:0,sso:null,mobile:u(),lang:l(),theme:null,drop:!0,comment_show_sort:null,comment_show_format:null,hide_all_chats:!1},t[e].config)};var f=function(){function t(){this.handlers=[]}return t.prototype.on=function(t){this.handlers.push(t)},t.prototype.off=function(t){this.handlers=this.handlers.filter(function(e){return e!==t})},t.prototype.trigger=function(t){this.handlers.slice(0).forEach(function(e){return e(t)})},t.prototype.expose=function(){return this},t}();e.CEvent=f;var h=function(){function t(t){this.win=t,this.html=this.win.document.documentElement||this.win.document.body}return Object.defineProperty(t.prototype,"scrollTop",{get:function(){return this.win.pageYOffset||this.win.document.documentElement.scrollTop||this.win.document.body.scrollTop},set:function(t){this.win.scrollTo(0,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollLeft",{get:function(){return this.win.pageXOffset||this.win.document.documentElement.scrollLeft||this.win.document.body.scrollLeft},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollHeight",{get:function(){return Math.max(this.win.document.body.scrollHeight,this.win.document.documentElement.scrollHeight,this.win.document.body.offsetHeight,this.win.document.documentElement.offsetHeight,this.win.document.body.clientHeight,this.win.document.documentElement.clientHeight)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"windowWidth",{get:function(){return this.win.document.documentElement.clientWidth||this.win.document.body.clientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"windowHeight",{get:function(){return this.win.innerHeight||this.win.document.documentElement.clientHeight||this.win.document.body.clientHeight},enumerable:!0,configurable:!0}),t}();e.ExtWindow=h;var d=function(t){function e(e,n){var i=t.call(this,e)||this,o=Math.random().toString().substr(2);return i.windowName=n,i.bodyclass=n+o,i.iframeclass=n+"iframe"+o,i.wrapperclass=n+"wrapper"+o,i}return o(e,t),e.prototype.CreateHiddenIframe=function(t){var e=this.win.document.createElement("iframe");return e.setAttribute("async","async"),e.setAttribute("scrolling","yes"),e.src=t,e.frameBorder="0",e.id=this.iframeclass+"hide",m(e.style,{position:"absolute",top:"-100000px",left:"-100000px",width:"1px",height:"1px"}),e},e.prototype.CreateIframe=function(t,e){var n=this.win.document.createElement("iframe");n.setAttribute("async","async"),n.setAttribute("scrolling","yes"),n.src=e,n.frameBorder="0",n.id=this.iframeclass;var i={display:"block",position:"absolute",width:"100%",height:"100%",boxShadow:"none",border:"none",background:"#fff",margin:0,padding:0};return t&&(i.zIndex="2000000002",i.boxShadow="0px 0px 10px 0px rgba(0,0,0,0.3)"),m(n.style,i),new _(n)},e.prototype.CreateWrapper=function(t){var e=this.win.document.createElement("div");e.id=this.wrapperclass;var n={display:"none",position:"relative",top:"auto",left:"auto",right:"auto",bottom:"auto",border:"none"};return t&&(n.zIndex="2000000001",n.position="fixed"),m(e.style,n),new _(e)},e.prototype.CreateStyle=function(t,e){var n=this.windowName,i=this.bodyclass,o=this.wrapperclass,r=this.iframeclass,s={theme_white:!0,color_main:"#4FA3BA",color_main_middle_dark:"#2C616F",color_main_middle:"#1D3F49"};for(var c in e)e.hasOwnProperty(c)&&(s[c]=e[c]);var a=t&&t.colorBackground?t.colorBackground:"#fff",u=t&&t.colorMain?t.colorMain:s.color_main,l=t&&t.colorMainMiddleDark?t.colorMainMiddleDark:s.theme_white?s.color_main_middle_dark:s.color_main_middle,f=document.createElement("style"),h=[{name:"."+i,styles:{position:"fixed",top:0,left:0,right:0,bottom:0,height:"100%",width:"100%"}},{name:"."+i+" body",styles:{"z-index":"auto"}},{name:"."+i+" body::after",styles:{display:"block",position:"absolute",top:0,left:0,right:0,bottom:0,border:"none",background:"rgba(0, 0, 0, 0.3)",content:'" "',"box-sizing":"border-box","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","z-index":"2000000000",margin:0,padding:0}},{name:"."+i+" #"+o,styles:{position:"absolute","z-index":"2000000004"}},{name:"."+i+" #"+r,styles:{"z-index":"2000000005"}},{name:"."+n+"-button",styles:{display:"block",margin:"0px auto","font-size":"14px","line-height":"14px","font-weight":"bold",border:"2px solid #4db6ba",padding:"11px 20px","border-radius":"5px","border-width":"0px","border-style":"solid",cursor:"pointer",background:u,color:a,"text-align":"center","text-transform":"uppercase"}},{name:"."+n+"-button:hover",styles:{background:l}}],d="";for(var c in h){var m="",_=h[c].styles;for(var p in _)m+=p+": "+_[p]+";";d+=h[c].name+"{"+m+"}"}return f.innerHTML=d,f},e.prototype.Hide=function(t){var e=this;this.html.classList?t?this.html.classList.add(this.bodyclass):this.html.classList.remove(this.bodyclass):this.html.className=this.html.className.split(" ").filter(function(t){return t!=e.bodyclass}).concat(t?this.bodyclass:"").filter(function(t){return""!=t}).join(" ")},e}(h);function m(t,e){for(var n in e)t[n]=e[n]}e.ExtExtendWindow=d,e.SetStyle=m;var _=function(){function t(t){this.elem=t,this._size={width:0,height:0},this._SetPosition({top:-1,left:0,bottom:0})}return t.prototype.px=function(t){return t<0?"auto":t+"px"},Object.defineProperty(t.prototype,"el",{get:function(){return this.elem},enumerable:!0,configurable:!0}),t.prototype._SetSize=function(t){this.elem.style.width=this.px(t.width),this.elem.style.height=this.px(t.height),this._size=t},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},set:function(t){t.width==this._size.width&&t.height==this._size.height||this._SetSize(t)},enumerable:!0,configurable:!0}),t.prototype._SetPosition=function(t){this.elem.style.top=this.px(t.top),this.elem.style.left=this.px(t.left),this.elem.style.bottom=this.px(t.bottom),this._position=t},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){t.top==this._position.top&&t.bottom==this._position.bottom&&t.left==this.position.left||this._SetPosition(t)},enumerable:!0,configurable:!0}),t.prototype._SetView=function(t){this._view=t,this.elem.style.display=t?"block":"none"},Object.defineProperty(t.prototype,"view",{get:function(){return this._view},set:function(t){this._view!=t&&this._SetView(t)},enumerable:!0,configurable:!0}),t.prototype.rect=function(){return this.elem.getBoundingClientRect()},t}();function p(t,e){for(var n in t=t||{},e)t[n]=e[n];return t}function v(t){var e=t,n=e.indexOf("#"),i=e.indexOf("?");return-1!=n&&(e=e.substr(0,n)),-1!=i&&(e=e.substr(0,i)),e}function w(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}e.ExtElement=_,e.GetCommentShow=function(t,e,n){if(t){var i=n[t.toLowerCase()];return i||0}return e},e.MD5=function(t){return r.md5(t)},e.Md5UrlWithoutHost=function(t){return r.md5(t.replace(/^(http[s]*:\/\/(m\.|www\.)*)*(.+)$/i,"$3"))},e.extend=p,e.NormolizeURL=v,function(t){t[t.domready=0]="domready",t[t.ready=1]="ready",t[t.open=2]="open",t[t.close=3]="close"}(e.VidjetEventName||(e.VidjetEventName={})),e.trim=w,function(t){t.init="init",t.miniwidget="miniwidget"}(e.ActionEnum||(e.ActionEnum={}))},function(t,e){var n=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},function(t,e,n){var i=n(12),o=n(28);t.exports=n(8)?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var i=n(1),o=n(5),r=n(13),s=n(19)("src"),c=Function.toString,a=(""+c).split("toString");n(4).inspectSource=function(t){return c.call(t)},(t.exports=function(t,e,n,c){var u="function"==typeof n;u&&(r(n,"name")||o(n,"name",e)),t[e]!==n&&(u&&(r(n,s)||o(n,s,t[e]?""+t[e]:a.join(String(e)))),t===i?t[e]=n:c?t[e]?t[e]=n:o(t,e,n):(delete t[e],o(t,e,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[s]||c.call(this)})},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){t.exports=!n(27)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports={}},function(t,e,n){"use strict";n.r(e),n.d(e,"PM_ALERT",function(){return i}),n.d(e,"PM_LOG",function(){return o}),n.d(e,"PM_PLAGIN",function(){return r}),n.d(e,"PM_INIT",function(){return s}),n.d(e,"PM_INIT_PREVIEW",function(){return c}),n.d(e,"PM_INIT_COMPLITE",function(){return a}),n.d(e,"PM_BEGIN_OPEN",function(){return u}),n.d(e,"PM_BEGIN_CLOSE",function(){return l}),n.d(e,"PM_COMPLITE_OPEN",function(){return f}),n.d(e,"PM_COMPLITE_CLOSE",function(){return h}),n.d(e,"PM_FOCUS",function(){return d}),n.d(e,"PM_RENDER",function(){return m}),n.d(e,"PM_RESIZE",function(){return _}),n.d(e,"PM_CURSOR",function(){return p}),n.d(e,"PM_LANG",function(){return v}),n.d(e,"PM_VIEW_NAV_FIRST",function(){return w}),n.d(e,"PM_VIEW_NAV",function(){return g}),n.d(e,"PM_VIEW_MAIN",function(){return y}),n.d(e,"PM_VIEW_AUTH",function(){return E}),n.d(e,"PM_VIEW_HEIGHT",function(){return b}),n.d(e,"PM_VIEW_COMMENT_FOCUS",function(){return P}),n.d(e,"PM_WINDOW_FOCUS",function(){return M}),n.d(e,"PM_WINDOW_BLUR",function(){return x}),n.d(e,"PM_WINDOW_SCROLL",function(){return O}),n.d(e,"PM_WINDOW_SCROLL_BEGIN",function(){return I}),n.d(e,"PM_DOCUMENT_TITLE",function(){return C}),n.d(e,"PM_BANNER_INIT",function(){return N}),n.d(e,"PM_BANNER_RESIZE",function(){return S}),n.d(e,"PM_DRAG_ENTER",function(){return T}),n.d(e,"PM_DRAG_LEAVE",function(){return L});var i="PM_ALERT",o="PM_LOG",r="PM_PLAGIN",s="PM_INIT",c="PM_INIT_PREVIEW",a="PM_INIT_COMPLITE",u="PM_BEGIN_OPEN",l="PM_BEGIN_CLOSE",f="PM_COMPLITE_OPEN",h="PM_COMPLITE_CLOSE",d="PM_FOCUS",m="PM_RENDER",_="PM_RESIZE",p="PM_CURSOR",v="PM_LANG",w="PM_VIEW_NAV_FIRST",g="PM_VIEW_NAV",y="PM_VIEW_MAIN",E="PM_VIEW_AUTH",b="PM_VIEW_HEIGHT",P="PM_VIEW_COMMENT_FOCUS",M="PM_WINDOW_FOCUS",x="PM_WINDOW_BLUR",O="PM_WINDOW_SCROLL",I="PM_WINDOW_SCROLL_BEGIN",C="PM_DOCUMENT_TITLE",N="PM_BANNER_INIT",S="PM_BANNER_RESIZE",T="PM_DRAG_ENTER",L="PM_DRAG_LEAVE"},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){var i=n(2),o=n(41),r=n(42),s=Object.defineProperty;e.f=n(8)?Object.defineProperty:function(t,e,n){if(i(t),e=r(e,!0),i(n),o)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var i=n(15);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,o){return t.call(e,n,i,o)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),o=n(3),r=function(){function t(t){this.onEvents={},this._messageEvent=this._messageEvent.bind(this),this.win=t,this.win.addEventListener("message",this._messageEvent,!1)}return t.prototype._messageEvent=function(t){var e=null;try{e=t.data}catch(t){}null!=e&&e.type&&i[e.type]&&this.onEvents[e.type]&&this.onEvents[e.type].trigger(e.data)},t.prototype.destroy=function(){this.win.removeEventListener("message",this._messageEvent,!1)},t.prototype.on=function(t,e){return this.onEvents[t]||(this.onEvents[t]=new o.CEvent),this.onEvents[t].on(e),this},t.prototype.off=function(t,e){return this.onEvents[t]||(this.onEvents[t]=new o.CEvent),this.onEvents[t].off(e),this},t.send=function(t,e){t.postMessage({type:e.type,data:e.data},"*")},t}();e.default=r},function(t,e,n){var i=n(11),o=n(0)("toStringTag"),r="Arguments"==i(function(){return arguments}());t.exports=function(t){var e,n,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),o))?n:r?i(e):"Object"==(s=i(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e){t.exports=!1},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},function(t,e,n){var i=n(7),o=n(1).document,r=i(o)&&i(o.createElement);t.exports=function(t){return r?o.createElement(t):{}}},function(t,e){var n=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:n)(t)}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,n){var i=n(49),o=n(22);t.exports=function(t){return i(o(t))}},function(t,e,n){var i=n(26)("keys"),o=n(19);t.exports=function(t){return i[t]||(i[t]=o(t))}},function(t,e,n){var i=n(12).f,o=n(13),r=n(0)("toStringTag");t.exports=function(t,e,n){t&&!o(t=n?t:t.prototype,r)&&i(t,r,{configurable:!0,value:e})}},function(t,e,n){var i=n(4),o=n(1),r=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,e){return r[t]||(r[t]=void 0!==e?e:{})})("versions",[]).push({version:i.version,mode:n(18)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){"use strict";var i=n(18),o=n(30),r=n(6),s=n(5),c=n(9),a=n(45),u=n(25),l=n(52),f=n(0)("iterator"),h=!([].keys&&"next"in[].keys()),d=function(){return this};t.exports=function(t,e,n,m,_,p,v){a(n,e,m);var w,g,y,E=function(t){if(!h&&t in x)return x[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},b=e+" Iterator",P="values"==_,M=!1,x=t.prototype,O=x[f]||x["@@iterator"]||_&&x[_],I=O||E(_),C=_?P?E("entries"):I:void 0,N="Array"==e&&x.entries||O;if(N&&(y=l(N.call(new t)))!==Object.prototype&&y.next&&(u(y,b,!0),i||"function"==typeof y[f]||s(y,f,d)),P&&O&&"values"!==O.name&&(M=!0,I=function(){return O.call(this)}),i&&!v||!h&&!M&&x[f]||s(x,f,I),c[e]=I,c[b]=d,_)if(w={values:P?I:E("values"),keys:p?I:E("keys"),entries:C},v)for(g in w)g in x||r(x,g,w[g]);else o(o.P+o.F*(h||M),e,w);return w}},function(t,e,n){var i=n(1),o=n(4),r=n(5),s=n(6),c=n(14),a=function(t,e,n){var u,l,f,h,d=t&a.F,m=t&a.G,_=t&a.S,p=t&a.P,v=t&a.B,w=m?i:_?i[e]||(i[e]={}):(i[e]||{}).prototype,g=m?o:o[e]||(o[e]={}),y=g.prototype||(g.prototype={});for(u in m&&(n=e),n)f=((l=!d&&w&&void 0!==w[u])?w:n)[u],h=v&&l?c(f,i):p&&"function"==typeof f?c(Function.call,f):f,w&&s(w,u,f,t&a.U),g[u]!=f&&r(g,u,h),p&&y[u]!=f&&(y[u]=f)};i.core=o,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,e,n){var i=n(48),o=n(33);t.exports=Object.keys||function(t){return i(t,o)}},function(t,e,n){var i=n(21),o=Math.min;t.exports=function(t){return t>0?o(i(t),9007199254740991):0}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,n){var i=n(1).document;t.exports=i&&i.documentElement},function(t,e,n){var i,o,r,s=n(14),c=n(65),a=n(34),u=n(20),l=n(1),f=l.process,h=l.setImmediate,d=l.clearImmediate,m=l.MessageChannel,_=l.Dispatch,p=0,v={},w=function(){var t=+this;if(v.hasOwnProperty(t)){var e=v[t];delete v[t],e()}},g=function(t){w.call(t.data)};h&&d||(h=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return v[++p]=function(){c("function"==typeof t?t:Function(t),e)},i(p),p},d=function(t){delete v[t]},"process"==n(11)(f)?i=function(t){f.nextTick(s(w,t,1))}:_&&_.now?i=function(t){_.now(s(w,t,1))}:m?(r=(o=new m).port2,o.port1.onmessage=g,i=s(r.postMessage,r,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(i=function(t){l.postMessage(t+"","*")},l.addEventListener("message",g,!1)):i="onreadystatechange"in u("script")?function(t){a.appendChild(u("script")).onreadystatechange=function(){a.removeChild(this),w.call(t)}}:function(t){setTimeout(s(w,t,1),0)}),t.exports={set:h,clear:d}},function(t,e,n){"use strict";var i=n(15);function o(t){var e,n;this.promise=new t(function(t,i){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=i}),this.resolve=i(e),this.reject=i(n)}t.exports.f=function(t){return new o(t)}},function(t,e,n){t.exports=n(38)},function(t,e,n){"use strict";var i=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};Object.defineProperty(e,"__esModule",{value:!0}),n(39),n(73);var o=n(3),r=n(76),s=n(79),c=n(80);!function(t){var e=o.LoadSettings(t);if(null===e)throw new Error("tc: settings no load");var n=t[e.WindowName];if(null==n.settings){n.settings=e;var a=o.LoadConfig(t,e.WindowName,n.t);n.filter(function(t){return t.action==o.ActionEnum.init}).forEach(function(t){return a=i({},a,t.values)}),n.comment=new s.default(e,a,t),o.LoadServer(e).then(function(i){n.settings.time=Date.now(),n.widget=n.vidget=new r.default(e,a,i,t),a.visible&&n.widget.init(),n.miniwidgets=new c.MiniWidgetGroup(e,a,i,t),n.filter(function(t){return t.action==o.ActionEnum.miniwidget}).forEach(function(t){n.miniwidgets.create(t.values)}),"function"==typeof a.success&&a.success()})}}(window)},function(t,e,n){n(40),n(43),n(54),n(58),t.exports=n(4).Promise},function(t,e,n){"use strict";var i=n(17),o={};o[n(0)("toStringTag")]="z",o+""!="[object z]"&&n(6)(Object.prototype,"toString",function(){return"[object "+i(this)+"]"},!0)},function(t,e,n){t.exports=!n(8)&&!n(27)(function(){return 7!=Object.defineProperty(n(20)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var i=n(7);t.exports=function(t,e){if(!i(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!i(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){"use strict";var i=n(44)(!0);n(29)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=i(e,n),this._i+=t.length,{value:t,done:!1})})},function(t,e,n){var i=n(21),o=n(22);t.exports=function(t){return function(e,n){var r,s,c=String(o(e)),a=i(n),u=c.length;return a<0||a>=u?t?"":void 0:(r=c.charCodeAt(a))<55296||r>56319||a+1===u||(s=c.charCodeAt(a+1))<56320||s>57343?t?c.charAt(a):r:t?c.slice(a,a+2):s-56320+(r-55296<<10)+65536}}},function(t,e,n){"use strict";var i=n(46),o=n(28),r=n(25),s={};n(5)(s,n(0)("iterator"),function(){return this}),t.exports=function(t,e,n){t.prototype=i(s,{next:o(1,n)}),r(t,e+" Iterator")}},function(t,e,n){var i=n(2),o=n(47),r=n(33),s=n(24)("IE_PROTO"),c=function(){},a=function(){var t,e=n(20)("iframe"),i=r.length;for(e.style.display="none",n(34).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;i--;)delete a.prototype[r[i]];return a()};t.exports=Object.create||function(t,e){var n;return null!==t?(c.prototype=i(t),n=new c,c.prototype=null,n[s]=t):n=a(),void 0===e?n:o(n,e)}},function(t,e,n){var i=n(12),o=n(2),r=n(31);t.exports=n(8)?Object.defineProperties:function(t,e){o(t);for(var n,s=r(e),c=s.length,a=0;c>a;)i.f(t,n=s[a++],e[n]);return t}},function(t,e,n){var i=n(13),o=n(23),r=n(50)(!1),s=n(24)("IE_PROTO");t.exports=function(t,e){var n,c=o(t),a=0,u=[];for(n in c)n!=s&&i(c,n)&&u.push(n);for(;e.length>a;)i(c,n=e[a++])&&(~r(u,n)||u.push(n));return u}},function(t,e,n){var i=n(11);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e,n){var i=n(23),o=n(32),r=n(51);t.exports=function(t){return function(e,n,s){var c,a=i(e),u=o(a.length),l=r(s,u);if(t&&n!=n){for(;u>l;)if((c=a[l++])!=c)return!0}else for(;u>l;l++)if((t||l in a)&&a[l]===n)return t||l||0;return!t&&-1}}},function(t,e,n){var i=n(21),o=Math.max,r=Math.min;t.exports=function(t,e){return(t=i(t))<0?o(t+e,0):r(t,e)}},function(t,e,n){var i=n(13),o=n(53),r=n(24)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=o(t),i(t,r)?t[r]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},function(t,e,n){var i=n(22);t.exports=function(t){return Object(i(t))}},function(t,e,n){for(var i=n(55),o=n(31),r=n(6),s=n(1),c=n(5),a=n(9),u=n(0),l=u("iterator"),f=u("toStringTag"),h=a.Array,d={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},m=o(d),_=0;_<m.length;_++){var p,v=m[_],w=d[v],g=s[v],y=g&&g.prototype;if(y&&(y[l]||c(y,l,h),y[f]||c(y,f,v),a[v]=h,w))for(p in i)y[p]||r(y,p,i[p],!0)}},function(t,e,n){"use strict";var i=n(56),o=n(57),r=n(9),s=n(23);t.exports=n(29)(Array,"Array",function(t,e){this._t=s(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,o(1)):o(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values"),r.Arguments=r.Array,i("keys"),i("values"),i("entries")},function(t,e,n){var i=n(0)("unscopables"),o=Array.prototype;null==o[i]&&n(5)(o,i,{}),t.exports=function(t){o[i][t]=!0}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,n){"use strict";var i,o,r,s,c=n(18),a=n(1),u=n(14),l=n(17),f=n(30),h=n(7),d=n(15),m=n(59),_=n(60),p=n(64),v=n(35).set,w=n(66)(),g=n(36),y=n(67),E=n(68),b=n(69),P=a.TypeError,M=a.process,x=M&&M.versions,O=x&&x.v8||"",I=a.Promise,C="process"==l(M),N=function(){},S=o=g.f,T=!!function(){try{var t=I.resolve(1),e=(t.constructor={})[n(0)("species")]=function(t){t(N,N)};return(C||"function"==typeof PromiseRejectionEvent)&&t.then(N)instanceof e&&0!==O.indexOf("6.6")&&-1===E.indexOf("Chrome/66")}catch(t){}}(),L=function(t){var e;return!(!h(t)||"function"!=typeof(e=t.then))&&e},R=function(t,e){if(!t._n){t._n=!0;var n=t._c;w(function(){for(var i=t._v,o=1==t._s,r=0,s=function(e){var n,r,s,c=o?e.ok:e.fail,a=e.resolve,u=e.reject,l=e.domain;try{c?(o||(2==t._h&&W(t),t._h=1),!0===c?n=i:(l&&l.enter(),n=c(i),l&&(l.exit(),s=!0)),n===e.promise?u(P("Promise-chain cycle")):(r=L(n))?r.call(n,a,u):a(n)):u(i)}catch(t){l&&!s&&l.exit(),u(t)}};n.length>r;)s(n[r++]);t._c=[],t._n=!1,e&&!t._h&&j(t)})}},j=function(t){v.call(a,function(){var e,n,i,o=t._v,r=A(t);if(r&&(e=y(function(){C?M.emit("unhandledRejection",o,t):(n=a.onunhandledrejection)?n({promise:t,reason:o}):(i=a.console)&&i.error&&i.error("Unhandled promise rejection",o)}),t._h=C||A(t)?2:1),t._a=void 0,r&&e.e)throw e.v})},A=function(t){return 1!==t._h&&0===(t._a||t._c).length},W=function(t){v.call(a,function(){var e;C?M.emit("rejectionHandled",t):(e=a.onrejectionhandled)&&e({promise:t,reason:t._v})})},V=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),R(e,!0))},D=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw P("Promise can't be resolved itself");(e=L(t))?w(function(){var i={_w:n,_d:!1};try{e.call(t,u(D,i,1),u(V,i,1))}catch(t){V.call(i,t)}}):(n._v=t,n._s=1,R(n,!1))}catch(t){V.call({_w:n,_d:!1},t)}}};T||(I=function(t){m(this,I,"Promise","_h"),d(t),i.call(this);try{t(u(D,this,1),u(V,this,1))}catch(t){V.call(this,t)}},(i=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(70)(I.prototype,{then:function(t,e){var n=S(p(this,I));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=C?M.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&R(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),r=function(){var t=new i;this.promise=t,this.resolve=u(D,t,1),this.reject=u(V,t,1)},g.f=S=function(t){return t===I||t===s?new r(t):o(t)}),f(f.G+f.W+f.F*!T,{Promise:I}),n(25)(I,"Promise"),n(71)("Promise"),s=n(4).Promise,f(f.S+f.F*!T,"Promise",{reject:function(t){var e=S(this);return(0,e.reject)(t),e.promise}}),f(f.S+f.F*(c||!T),"Promise",{resolve:function(t){return b(c&&this===s?I:this,t)}}),f(f.S+f.F*!(T&&n(72)(function(t){I.all(t).catch(N)})),"Promise",{all:function(t){var e=this,n=S(e),i=n.resolve,o=n.reject,r=y(function(){var n=[],r=0,s=1;_(t,!1,function(t){var c=r++,a=!1;n.push(void 0),s++,e.resolve(t).then(function(t){a||(a=!0,n[c]=t,--s||i(n))},o)}),--s||i(n)});return r.e&&o(r.v),n.promise},race:function(t){var e=this,n=S(e),i=n.reject,o=y(function(){_(t,!1,function(t){e.resolve(t).then(n.resolve,i)})});return o.e&&i(o.v),n.promise}})},function(t,e){t.exports=function(t,e,n,i){if(!(t instanceof e)||void 0!==i&&i in t)throw TypeError(n+": incorrect invocation!");return t}},function(t,e,n){var i=n(14),o=n(61),r=n(62),s=n(2),c=n(32),a=n(63),u={},l={};(e=t.exports=function(t,e,n,f,h){var d,m,_,p,v=h?function(){return t}:a(t),w=i(n,f,e?2:1),g=0;if("function"!=typeof v)throw TypeError(t+" is not iterable!");if(r(v)){for(d=c(t.length);d>g;g++)if((p=e?w(s(m=t[g])[0],m[1]):w(t[g]))===u||p===l)return p}else for(_=v.call(t);!(m=_.next()).done;)if((p=o(_,w,m.value,e))===u||p===l)return p}).BREAK=u,e.RETURN=l},function(t,e,n){var i=n(2);t.exports=function(t,e,n,o){try{return o?e(i(n)[0],n[1]):e(n)}catch(e){var r=t.return;throw void 0!==r&&i(r.call(t)),e}}},function(t,e,n){var i=n(9),o=n(0)("iterator"),r=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||r[o]===t)}},function(t,e,n){var i=n(17),o=n(0)("iterator"),r=n(9);t.exports=n(4).getIteratorMethod=function(t){if(null!=t)return t[o]||t["@@iterator"]||r[i(t)]}},function(t,e,n){var i=n(2),o=n(15),r=n(0)("species");t.exports=function(t,e){var n,s=i(t).constructor;return void 0===s||null==(n=i(s)[r])?e:o(n)}},function(t,e){t.exports=function(t,e,n){var i=void 0===n;switch(e.length){case 0:return i?t():t.call(n);case 1:return i?t(e[0]):t.call(n,e[0]);case 2:return i?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return i?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return i?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}return t.apply(n,e)}},function(t,e,n){var i=n(1),o=n(35).set,r=i.MutationObserver||i.WebKitMutationObserver,s=i.process,c=i.Promise,a="process"==n(11)(s);t.exports=function(){var t,e,n,u=function(){var i,o;for(a&&(i=s.domain)&&i.exit();t;){o=t.fn,t=t.next;try{o()}catch(i){throw t?n():e=void 0,i}}e=void 0,i&&i.enter()};if(a)n=function(){s.nextTick(u)};else if(!r||i.navigator&&i.navigator.standalone)if(c&&c.resolve){var l=c.resolve(void 0);n=function(){l.then(u)}}else n=function(){o.call(i,u)};else{var f=!0,h=document.createTextNode("");new r(u).observe(h,{characterData:!0}),n=function(){h.data=f=!f}}return function(i){var o={fn:i,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,n){var i=n(1).navigator;t.exports=i&&i.userAgent||""},function(t,e,n){var i=n(2),o=n(7),r=n(36);t.exports=function(t,e){if(i(t),o(e)&&e.constructor===t)return e;var n=r.f(t);return(0,n.resolve)(e),n.promise}},function(t,e,n){var i=n(6);t.exports=function(t,e,n){for(var o in e)i(t,o,e[o],n);return t}},function(t,e,n){"use strict";var i=n(1),o=n(12),r=n(8),s=n(0)("species");t.exports=function(t){var e=i[t];r&&e&&!e[s]&&o.f(e,s,{configurable:!0,get:function(){return this}})}},function(t,e,n){var i=n(0)("iterator"),o=!1;try{var r=[7][i]();r.return=function(){o=!0},Array.from(r,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!o)return!1;var n=!1;try{var r=[7],s=r[i]();s.next=function(){return{done:n=!0}},r[i]=function(){return s},t(r)}catch(t){}return n}},function(t,e){self.fetch||(self.fetch=function(t,e){return e=e||{},new Promise(function(n,i){var o=new XMLHttpRequest;for(var r in o.open(e.method||"get",t,!0),e.headers)o.setRequestHeader(r,e.headers[r]);function s(){var t,e=[],n=[],i={};return o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(o,r,s){e.push(r=r.toLowerCase()),n.push([r,s]),i[r]=(t=i[r])?t+","+s:s}),{ok:2==(o.status/100|0),status:o.status,statusText:o.statusText,url:o.responseURL,clone:s,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},headers:{keys:function(){return e},entries:function(){return n},get:function(t){return i[t.toLowerCase()]},has:function(t){return t.toLowerCase()in i}}}}o.withCredentials="include"==e.credentials,o.onload=function(){n(s())},o.onerror=i,o.send(e.body||null)})})},function(t,e,n){"use strict";function i(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function o(t,e,n,o,r,s){return i((c=i(i(e,t),i(o,s)))<<(a=r)|c>>>32-a,n);var c,a}function r(t,e,n,i,r,s,c){return o(e&n|~e&i,t,e,r,s,c)}function s(t,e,n,i,r,s,c){return o(e&i|n&~i,t,e,r,s,c)}function c(t,e,n,i,r,s,c){return o(e^n^i,t,e,r,s,c)}function a(t,e,n,i,r,s,c){return o(n^(e|~i),t,e,r,s,c)}function u(t){return function(t){var e,n="",i=32*t.length;for(e=0;e<i;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}(function(t,e){var n,o,u,l,f;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var h=1732584193,d=-271733879,m=-1732584194,_=271733878;for(n=0;n<t.length;n+=16)o=h,u=d,l=m,f=_,h=r(h,d,m,_,t[n],7,-680876936),_=r(_,h,d,m,t[n+1],12,-389564586),m=r(m,_,h,d,t[n+2],17,606105819),d=r(d,m,_,h,t[n+3],22,-1044525330),h=r(h,d,m,_,t[n+4],7,-176418897),_=r(_,h,d,m,t[n+5],12,1200080426),m=r(m,_,h,d,t[n+6],17,-1473231341),d=r(d,m,_,h,t[n+7],22,-45705983),h=r(h,d,m,_,t[n+8],7,1770035416),_=r(_,h,d,m,t[n+9],12,-1958414417),m=r(m,_,h,d,t[n+10],17,-42063),d=r(d,m,_,h,t[n+11],22,-1990404162),h=r(h,d,m,_,t[n+12],7,1804603682),_=r(_,h,d,m,t[n+13],12,-40341101),m=r(m,_,h,d,t[n+14],17,-1502002290),h=s(h,d=r(d,m,_,h,t[n+15],22,1236535329),m,_,t[n+1],5,-165796510),_=s(_,h,d,m,t[n+6],9,-1069501632),m=s(m,_,h,d,t[n+11],14,643717713),d=s(d,m,_,h,t[n],20,-373897302),h=s(h,d,m,_,t[n+5],5,-701558691),_=s(_,h,d,m,t[n+10],9,38016083),m=s(m,_,h,d,t[n+15],14,-660478335),d=s(d,m,_,h,t[n+4],20,-405537848),h=s(h,d,m,_,t[n+9],5,568446438),_=s(_,h,d,m,t[n+14],9,-1019803690),m=s(m,_,h,d,t[n+3],14,-187363961),d=s(d,m,_,h,t[n+8],20,1163531501),h=s(h,d,m,_,t[n+13],5,-1444681467),_=s(_,h,d,m,t[n+2],9,-51403784),m=s(m,_,h,d,t[n+7],14,1735328473),h=c(h,d=s(d,m,_,h,t[n+12],20,-1926607734),m,_,t[n+5],4,-378558),_=c(_,h,d,m,t[n+8],11,-2022574463),m=c(m,_,h,d,t[n+11],16,1839030562),d=c(d,m,_,h,t[n+14],23,-35309556),h=c(h,d,m,_,t[n+1],4,-1530992060),_=c(_,h,d,m,t[n+4],11,1272893353),m=c(m,_,h,d,t[n+7],16,-155497632),d=c(d,m,_,h,t[n+10],23,-1094730640),h=c(h,d,m,_,t[n+13],4,681279174),_=c(_,h,d,m,t[n],11,-358537222),m=c(m,_,h,d,t[n+3],16,-722521979),d=c(d,m,_,h,t[n+6],23,76029189),h=c(h,d,m,_,t[n+9],4,-640364487),_=c(_,h,d,m,t[n+12],11,-421815835),m=c(m,_,h,d,t[n+15],16,530742520),h=a(h,d=c(d,m,_,h,t[n+2],23,-995338651),m,_,t[n],6,-198630844),_=a(_,h,d,m,t[n+7],10,1126891415),m=a(m,_,h,d,t[n+14],15,-1416354905),d=a(d,m,_,h,t[n+5],21,-57434055),h=a(h,d,m,_,t[n+12],6,1700485571),_=a(_,h,d,m,t[n+3],10,-1894986606),m=a(m,_,h,d,t[n+10],15,-1051523),d=a(d,m,_,h,t[n+1],21,-2054922799),h=a(h,d,m,_,t[n+8],6,1873313359),_=a(_,h,d,m,t[n+15],10,-30611744),m=a(m,_,h,d,t[n+6],15,-1560198380),d=a(d,m,_,h,t[n+13],21,1309151649),h=a(h,d,m,_,t[n+4],6,-145523070),_=a(_,h,d,m,t[n+11],10,-1120210379),m=a(m,_,h,d,t[n+2],15,718787259),d=a(d,m,_,h,t[n+9],21,-343485551),h=i(h,o),d=i(d,u),m=i(m,l),_=i(_,f);return[h,d,m,_]}(function(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;e<n.length;e+=1)n[e]=0;var i=8*t.length;for(e=0;e<i;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}(t),8*t.length))}Object.defineProperty(e,"__esModule",{value:!0}),e.md5=function(t){return function(t){var e,n,i="";for(n=0;n<t.length;n+=1)e=t.charCodeAt(n),i+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(15&e);return i}(u(unescape(encodeURIComponent(t))))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VERSION="0.0.1",e.DOMAIN_ZONE=".tolstoycomments.com"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(77),r=n(10),s=n(16),c=n(78),a=function(){return function(t,e,n,a){var u,l=this;this.isinit=!1,this.isfocus=!1,this.isdomlaod=!1,this.events=((u={})[i.VidjetEventName[i.VidjetEventName.domready]]=new i.CEvent,u[i.VidjetEventName[i.VidjetEventName.ready]]=new i.CEvent,u[i.VidjetEventName[i.VidjetEventName.open]]=new i.CEvent,u[i.VidjetEventName[i.VidjetEventName.close]]=new i.CEvent,u),this.init=function(){l.isinit||(l.isinit=!0,l.iframe=new o.ExtIframe({window:l.window,windowName:l.setting.WindowName,server:l.server,src:l.setting.ServerUrl+"/widget/index.html?t="+l.time,config:l.config}),l.pm.on(r.PM_BEGIN_CLOSE,l.close).on(r.PM_BEGIN_OPEN,l.open).on(r.PM_COMPLITE_CLOSE,l._close).on(r.PM_COMPLITE_OPEN,l._open).on(r.PM_INIT,l._initial).on(r.PM_INIT_COMPLITE,l._init_complite).on(r.PM_INIT_PREVIEW,l._init_preview).on(r.PM_VIEW_NAV_FIRST,l._navFirst).on(r.PM_ALERT,l._alert).on(r.PM_FOCUS,l.scroll).on(r.PM_CURSOR,l.cursor).on(r.PM_DOCUMENT_TITLE,l._title),l.iframe.EventOpenButton.on(l._openButton),/inter|comp/.test(document.readyState)?l._readyDom():(l.window.addEventListener("load",l._readyDom,!1),l.window.document.addEventListener("DOMContentLoaded",l._readyDom,!1),l.timerdomload=l.window.setTimeout(l._readyDom,1e4)),l.window.document.addEventListener("visibilitychange",l._eventVisibilitychange,!1))},this.destroy=function(){l.isinit&&(l.isinit=!1,l.iframe.destroy(),l.pm.off(r.PM_BEGIN_CLOSE,l._close).off(r.PM_BEGIN_OPEN,l._open).off(r.PM_COMPLITE_CLOSE,l.close).off(r.PM_COMPLITE_OPEN,l.open).off(r.PM_INIT,l._initial).off(r.PM_INIT_COMPLITE,l._init_complite).off(r.PM_INIT_PREVIEW,l._init_preview).off(r.PM_VIEW_NAV_FIRST,l._navFirst).off(r.PM_ALERT,l._alert).off(r.PM_FOCUS,l.scroll).off(r.PM_CURSOR,l.cursor).off(r.PM_DOCUMENT_TITLE,l._title),l.iframe.EventOpenButton.off(l._openButton),l.window.removeEventListener("load",l._readyDom,!1),l.window.removeEventListener("DOMContentLoaded",l._readyDom,!1),clearTimeout(l.timerdomload),l.window.document.removeEventListener("visibilitychange",l._eventVisibilitychange,!1))},this._nav=function(t){if(l.iframe){var e=null==t.url?l.config.url:t.url;l.postmessage(r.PM_VIEW_NAV,{site_id:l.setting.SiteId,url:e,title:i.escapeHtml(i.trim(null==t.title?l.config.title:t.title).substr(0,255)),hash:null==t.identity?null:i.MD5(t.identity),identity:t.identity})}},this._main=function(){l.postmessage(r.PM_VIEW_MAIN)},this._auth=function(){l.postmessage(r.PM_VIEW_AUTH)},this._windowFocus=!0,this._eventVisibilitychange=function(){l._eventWindowTimer(!l.window.document.hidden)},this._eventWindowTimer=function(t){l._windowFocus!=t&&(l._windowFocus=t,l.postmessage(t?r.PM_WINDOW_FOCUS:r.PM_WINDOW_BLUR))},this._initial=function(t){l.VERSION=t.VERSION,l.lang(l.config.lang),l.postmessage(r.PM_INIT,{site_id:l.setting.SiteId,uuid:l.server.uuid,vidjet_open:l.iframe&&l.iframe.Turn(),url:l.config.url,hash:null==l.config.identity?null:i.MD5(l.config.identity),identity:l.config.identity,render_in_content:l.iframe.IsRenderElement(),height_auto:l.iframe.IsHeightAuto(),server:l.server,href:l.setting.Href,sso:l.config.sso,scroll_border_top:l.config.scroll_border_top,scroll_border_bottom:l.config.scroll_border_bottom,time_client:l.setting.time,theme:l.config.theme,comment_show_sort:i.GetCommentShow(l.config.comment_show_sort,l.server.comment_show_sort,{desc:1}),comment_show_format:i.GetCommentShow(l.config.comment_show_format,l.server.comment_show_format,{tree:1}),hide_all_chats:!!l.config.hide_all_chats}),l.events[i.VidjetEventName[i.VidjetEventName.ready]].trigger()},this._alert=function(t){alert(t)},this._title=function(t){l.postmessage(r.PM_DOCUMENT_TITLE,{title:document.title}),""!=t&&document.title!=t&&(document.title=t)},this._openButton=function(){l.open(),l.navfirst()},this._navFirst=function(){l.config.main?l._main():(l._nav({url:l.config.url,title:i.escapeHtml(i.trim(l.config.title).substr(0,255)),identity:l.config.identity}),null!=l.commentSelect&&(l._open(),l.postmessage(r.PM_VIEW_COMMENT_FOCUS,{commentId:l.commentSelect}),l.iframe.IsRenderElement()&&(l.isfocus||(l.isfocus=!0,l.isdomlaod?l.iframe.Scroll():l.events[i.VidjetEventName[i.VidjetEventName.domready]].on(function(){l.iframe.Scroll()})))))},this._readyDom=function(){l.isdomlaod||(l.isdomlaod=!0,l.events[i.VidjetEventName[i.VidjetEventName.domready]].trigger())},this._init_complite=function(){l.iframe.InitComplite()},this._init_preview=function(){null==l.server.show_popup_mobile&&null==l.server.show_popup_desktop||l.iframe.AddPlagin(new c.PopupPlagin({setting:l.setting,config:l.config,window:l.window,version:l.VERSION,isRenderElement:l.iframe.IsRenderElement()})),l.iframe.onRenderFirst(),l.postmessage(r.PM_INIT_PREVIEW)},this.postmessage=function(t,e){void 0===e&&(e=null),l.iframe.PostMessage(t,e)},this.on=function(t,e){l.events[t]&&l.events[t].on(e)},this.off=function(t,e){l.events[t]&&l.events[t].off(e)},this.ready=function(){return l.isinit},this._open=function(){l.iframe.TurnOpen(),l.events[i.VidjetEventName[i.VidjetEventName.open]].trigger()},this._close=function(){l.iframe.TurnClose(),l.events[i.VidjetEventName[i.VidjetEventName.close]].trigger()},this.open=function(){l.iframe.PostMessage(r.PM_BEGIN_OPEN)},this.close=function(){l.iframe.PostMessage(r.PM_BEGIN_CLOSE)},this.isopen=function(){return l.iframe.Turn()},this.main=function(){l._main()},this.nav=function(t){l._nav(t)},this.navfirst=function(){l._navFirst()},this.auth=function(){l._auth()},this.scroll=function(){l.iframe.Scroll()},this.cursor=function(){l.iframe.Cursor()},this.lang=function(t){l.postmessage(r.PM_LANG,{lang:t})},this.log=function(t){l.postmessage(r.PM_LOG,{value:t})},this.setting=t,this.window=a,this.config=e,this.server=n,this.commentSelect=t.CommentSelect,this.pm=new s.default(a),this.time=(new Date).getTime().toString()}}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,o,r=n(3),s=n(16),c=n(10);!function(t){t[t.win=0]="win",t[t.def=1]="def"}(i||(i={})),function(t){t[t.win=0]="win",t[t.def=1]="def",t[t.turn=2]="turn"}(o||(o={}));var a=function(){function t(e){var n=this;this.onInit=new r.CEvent,this.onInitComplite=new r.CEvent,this.onDestroy=new r.CEvent,this.onOpen=new r.CEvent,this.onClose=new r.CEvent,this.onResize=new r.CEvent,this.onRender=new r.CEvent,this.onOpenButton=new r.CEvent,this.onRenderFirst=function(){n.wrapper.view=!0,n.render(),n.onInit.trigger()},this.onResizeWindowTimer=function(){n.extwin.win.clearTimeout(n.resizeWindowTimer),n.resizeWindowTimer=n.extwin.win.setTimeout(n.onResizeWindow,300)},this.onResizeWindow=function(){n.render(),n.onResize.trigger()},this.render=function(){if(null!=n.server){n.config.mobile&&1==n.show_classic_mobile&&(n.wrapper.view=!n._turn);var e=n.server.view_border,i=n.server.view_position;n.config.mobile&&(e=0);var o=n.extwin.windowWidth,r=n.extwin.windowHeight;if(n.height_auto)n.wrapper.size=t.CreateSizeHeightAuto(n._turn,n._turn_height,n.height_value,n.comment_element),n.wrapper.position=t.createPositionComment();else if(n.render_in_comment_element)n.wrapper.size=t.CreateSizeComment(n._turn,n._turn_height,r,n.comment_element),n.wrapper.position=t.createPositionComment();else{var s={width:Math.min(n.server.view_width,o),height:Math.min(n.server.view_height,r)};n.wrapper.size=t.CreateSizeDefault(n.config.mobile,n._turn,s,n._turn_height,o,r,i),n.wrapper.position=t.createPositionDefault(n.config.mobile,n._turn,s,n.wrapper.size,e,o,r,i)}if(n.iframe.size=n.wrapper.size,n.config.mobile&&0==n.render_in_comment_element&&n._focus!=!n._turn&&(n._focus=!n._turn,n.extwin.Hide(n._focus),n._focus||(n.extwin.scrollTop=n._scroll_window)),null!=n._scrollTopNext){var c=n.iframe.rect(),a=n.extwin.scrollTop+c.top+Math.max(0,Math.min(c.height-n.extwin.windowHeight-n.config.scroll_border_top,n._scrollTopNext))-n.config.scroll_border_top;n.extwin.scrollTop=a,n._scrollTopNext=null}n.onRender.trigger({elem:n.wrapper,turn:n._turn,isMobile:n.config.mobile,has_comment_element:null!=n.comment_element,render_in_comment_element:n.render_in_comment_element,size:n.wrapper.size,view_position:i,border:e})}},this._height=function(t){n.height_value=t.height,n.render()},this._scroll=function(t){n._scrollTopNext=t.scroll,n.render()},this.scrollWindowTimer=null,this.onScrollWindowEvent=function(){null==n.scrollWindowTimer&&n.PostMessage(c.PM_WINDOW_SCROLL_BEGIN),n.extwin.win.clearTimeout(n.scrollWindowTimer),n.scrollWindowTimer=n.extwin.win.setTimeout(n.onScrollWindowCallback,300)},this.onScrollWindowCallback=function(){var t=n.iframe.rect(),e=n.extwin.win.pageYOffset+t.top;n.PostMessage(c.PM_WINDOW_SCROLL,{scroll:n.extwin.scrollTop-e}),n._focus||(n._scroll_window=n.extwin.scrollTop),n.scrollWindowTimer=null},this._turn=!0,this._turn_height=50,this._focus=!1,this._scroll_window=0,this.plagins={},this._dragtimer=null,this._dragenter=function(){n.PostMessage(c.PM_DRAG_ENTER)},this._dragleave=function(){n.PostMessage(c.PM_DRAG_LEAVE)},this.AddPlagin=function(t){null==n.plagins[t.name]&&(n.plagins[t.name]=t,n.plagins[t.name].install.call(null,n))},this.RemovePlagin=function(t){null!=n.plagins[t.name]&&(n.plagins[t.name].uninstall.call(null,n),delete n.plagins[t.name])},this.InitComplite=function(){n.onInitComplite.trigger()},this.IsRenderElement=function(){return n.render_in_comment_element},this.IsHeightAuto=function(){return n.height_auto},this.Turn=function(){return!n._turn},this.TurnOpen=function(){n._turn&&(n._turn=!1,n.render(),n.onOpen.trigger())},this.TurnClose=function(){n._turn||(n._turn=!0,n.render(),n.onClose.trigger())},this.Scroll=function(){if(!n.config.mobile&&null!=n.comment_element)var t=100,e=window.setInterval(function(){0!=n.iframe.rect().top&&("scrollRestoration"in window.history&&(window.history.scrollRestoration="manual"),window.scrollTo(0,window.pageYOffset+n.iframe.rect().top-n.config.scroll_border_top),clearInterval(e)),t<0&&clearInterval(e),t--},100)},this.Open=function(){n.PostMessage(c.PM_BEGIN_OPEN)},this.lose=function(){n.PostMessage(c.PM_BEGIN_CLOSE)},this._EventOpen=function(){n.PostMessage(c.PM_COMPLITE_OPEN)},this._EventClose=function(){n.PostMessage(c.PM_COMPLITE_CLOSE)},this._EventRender=function(t){n.PostMessage(c.PM_RENDER,{size:{width:t.size.width,height:t.size.height},window:{width:n.extwin.windowWidth,height:n.extwin.windowHeight}})},this.Cursor=function(){n.render()},this.PostMessage=function(t,e){void 0===e&&(e=null),s.default.send(n.iframe.el.contentWindow,{type:t,data:e})},this.destroy=function(){for(var t in n.pm.off(c.PM_VIEW_HEIGHT,n._height),n.pm.off(c.PM_WINDOW_SCROLL,n._scroll),n.EventOpen.off(n._EventOpen),n.EventClose.off(n._EventClose),n.EventRender.off(n._EventRender),n.extwin.win.removeEventListener("resize",n.onResizeWindowTimer,!1),n.extwin.win.removeEventListener("scroll",n.onScrollWindowEvent,!1),n.wrapper.el.parentNode.removeChild(n.wrapper.el),n.plagins)n.plagins[t].name&&n.plagins[t].uninstall.call(null,n);n.onDestroy.trigger(),n.extwin.win.document.removeEventListener("dragenter",n._dragenter,!1),n.extwin.win.document.removeEventListener("dragover",n._dragenter,!1),n.extwin.win.document.removeEventListener("dragleave",n._dragleave,!1),n.extwin.win.document.removeEventListener("drop",n._dragleave,!1)},this.pm=new s.default(window),this.pm.on(c.PM_VIEW_HEIGHT,this._height),this.pm.on(c.PM_WINDOW_SCROLL,this._scroll),this.EventOpen.on(this._EventOpen),this.EventClose.on(this._EventClose),this.EventRender.on(this._EventRender),this.server=e.server,this.config=e.config,this.extwin=new r.ExtExtendWindow(e.window,e.windowName),this.show_classic_desktop=null!=this.config.show_classic_desktop?this.config.show_classic_desktop:this.server.show_classic_desktop,this.show_classic_mobile=null!=this.config.show_classic_mobile?this.config.show_classic_mobile:this.server.show_classic_mobile,this.comment_element=t.InitCommentBlock({window:e.window,desktop_class:this.config.desktop_class,show_classic_desktop:this.show_classic_desktop,show_classic_mobile:this.show_classic_mobile,mobile:this.config.mobile}),this.render_in_comment_element=!1;var i=!0;if(null!=this.comment_element)if(this.config.mobile)switch(this.show_classic_mobile){case 2:i=!1}else switch(this.show_classic_desktop){case 2:case 1:i=!1}if(this.iframe=this.extwin.CreateIframe(i,e.src),this.wrapper=this.extwin.CreateWrapper(i),this.wrapper.view=!1,this.style=this.extwin.CreateStyle(this.config.theme,this.server.theme),this.extwin.win.addEventListener("resize",this.onResizeWindowTimer,!1),this.extwin.win.addEventListener("scroll",this.onScrollWindowEvent,!1),this.wrapper.el.appendChild(this.iframe.el),this.wrapper.el.appendChild(this.style),null!=this.comment_element)if(this.config.mobile&&1==this.show_classic_mobile){var o=document.createElement("a");o.innerText=this.config.comment_button_text,o.className=e.windowName+"-button",o.addEventListener("click",function(){n.onOpenButton.trigger()}),"SCRIPT"==this.comment_element.tagName?this.comment_element.parentNode.insertBefore(o,this.comment_element):this.comment_element.appendChild(o),e.window.document.body.appendChild(this.wrapper.el)}else"SCRIPT"==this.comment_element.tagName?this.comment_element.parentNode.insertBefore(this.wrapper.el,this.comment_element):this.comment_element.appendChild(this.wrapper.el),this.render_in_comment_element=!0;else e.window.document.body.appendChild(this.wrapper.el);this.height_auto=this.render_in_comment_element&&2===(this.config.mobile?this.show_classic_mobile:this.show_classic_desktop),this.config.drop&&(this.extwin.win.document.addEventListener("dragenter",this._dragenter,!1),this.extwin.win.document.addEventListener("dragover",this._dragenter,!1),this.extwin.win.document.addEventListener("dragleave",this._dragleave,!1),this.extwin.win.document.addEventListener("drop",this._dragleave,!1))}return t.CreateSizeDefault=function(t,e,n,i,o,r,s){return{width:t?o:s>=6&&e?i:n.width,height:t?e?i:r:e?s>=6?Math.min(r,300):i:n.height}},t.CreateSizeHeightAuto=function(t,e,n,i){return{width:("SCRIPT"==i.tagName?i.parentElement:i).getBoundingClientRect().width,height:t?e:n}},t.CreateSizeComment=function(t,e,n,i){return{width:("SCRIPT"==i.tagName?i.parentElement:i).getBoundingClientRect().width,height:t?e:Math.min(800,Math.max(n-200,550))}},t.FindScriptTC=function(){var t,e=document.getElementsByTagName("script");for(var n in e){if((t=e[n]).textContent&&t.textContent.length<300)if(t.textContent.match(/\/\/(test|web)\.tolstoycomments\.com\/sitejs\/app\.js\?i\=/))return t}return null},t.InitCommentBlock=function(t){if(t.mobile?t.show_classic_mobile:t.show_classic_desktop>0){var e=t.window.document.getElementsByClassName(t.desktop_class)[0];return null!=e?e:this.FindScriptTC()}return null},Object.defineProperty(t.prototype,"EventInit",{get:function(){return this.onInit.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EventInitComplite",{get:function(){return this.onInitComplite.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EventDestroy",{get:function(){return this.onDestroy.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EventOpen",{get:function(){return this.onOpen.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EventClose",{get:function(){return this.onClose.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EventRender",{get:function(){return this.onRender.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"EventOpenButton",{get:function(){return this.onOpenButton.expose()},enumerable:!0,configurable:!0}),t.createPositionDefault=function(t,e,n,i,o,r,s,c){var a=0,u=0,l=0;if(t)return{top:-1,left:a,bottom:0};if(e){switch(c){case 0:case 3:a=r-(n.width+o);break;case 1:case 4:a=o;break;case 2:case 5:a=r/2-n.width/2;break;case 6:case 7:case 8:a=0;break;case 9:case 10:case 11:a=r-i.width}return a=c<6?Math.max(Math.min(Math.max(r-n.width,0),a),0):Math.max(Math.min(Math.max(r-i.width,0),a),0),c<3?(u=-1,l=0):c<6?(u=0,l=-1):6==c||9==c?(u=20,l=-1):8==c||11==c?(u=-1,l=20):(u=s/2-i.height/2,l=-1),{top:u,left:a,bottom:l}}switch(c){case 0:case 3:case 9:case 10:case 11:a=r-(n.width+o);break;case 1:case 4:case 6:case 7:case 8:a=o;break;case 2:case 5:a=r/2-n.width/2}return c<3||c>=6?(u=-1,l=0):c<6&&(u=0,l=-1),{top:u,left:a=Math.max(Math.min(Math.max(r-n.width,0),a),0),bottom:l}},t.createPositionComment=function(){return{top:0,bottom:0,left:0}},t}();e.ExtIframe=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(16),r=n(10),s=function(){function t(t){this.name_iframe_class="app-comment-popup",this.name_iframe_class_hide="app-comment-popup_hide",this.name="PopupPlagin",this.extwin=new i.ExtWindow(t.window),this.setting=t.setting,this.version=t.version,this.eventRender=this.eventRender.bind(this),this.eventPM=this.eventPM.bind(this),this.install=this.install.bind(this),this.uninstall=this.uninstall.bind(this),this.init=this.init.bind(this)}return t.createIframe=function(t){var e=window.document.createElement("iframe");return e.setAttribute("async","async"),e.setAttribute("scrolling","yes"),e.frameBorder="0",i.SetStyle(e.style,{display:"none",position:"fixed",width:"0px",height:"0px","z-index":"2000000010",margin:"0px",padding:"0px"}),e},t.prototype.eventRender=function(t){this.data_render_old=t;var e=Math.min(this.extwin.windowWidth,400),n=e+t.border;this.iframe.position={top:-1,left:this.extwin.windowWidth>n?this.extwin.windowWidth-n:0,bottom:t.has_comment_element||t.view_position>=3?0:t.size.height},this.iframe.size={width:e,height:this.win&&this.iframe_div.offsetHeight}},t.prototype.sendPM=function(t){this.main.PostMessage(r.PM_PLAGIN,{name:this.name,data:t})},t.prototype._showIframeDiv=function(t){var e=this;this.iframe_div.className=this.iframe_div.className.split(" ").filter(function(t){return t!=e.name_iframe_class_hide}).concat(t?"":this.name_iframe_class_hide).filter(function(t){return""!=t}).join(" ")},t.prototype.eventPM=function(t){var e=this;if(t.name==this.name||!t.data){if(null!=t.data.render){""!=t.data.render&&(this.iframe_div.innerHTML=t.data.render);for(var n=this.iframe.el.contentDocument.getElementsByClassName("action-plagin"),i=function(t){var i=n[t];i.addEventListener("click",function(t){t.stopPropagation(),e.sendPM({action:i.getAttribute("data-action")})})},o=0;o<n.length;o++)i(o)}null!=t.data.show&&this._showIframeDiv(t.data.show),null!=t.data.view&&(this.iframe.view=t.data.view,this.iframe.view?this.timer_resize=this.extwin.win.setInterval(function(){e.data_render_old&&e.eventRender(e.data_render_old)},1e3):this.extwin.win.clearInterval(this.timer_resize)),this.data_render_old&&this.eventRender(this.data_render_old)}},t.prototype.init=function(){this.extwin.win.document.body.appendChild(this.iframe.el),this.iframe.view=!0;var t=["<!doctype html>","<html>","<head>",'<meta charset="utf-8">','<meta name="viewport" content="width=device-width, initial-scale=1">','<link id="css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">','<link rel="stylesheet" href="'+this.setting.ServerUrl+"/widget/css/popup.css?v="+this.version+'">',"</head>","<body>",'<div class="'+this.name_iframe_class+" "+this.name_iframe_class_hide+'"></div>',"</body>","</html>"],e=this.iframe.el.contentDocument;e.open(),e.write(t.join("")),e.close(),this.iframe_div=e.getElementsByClassName(this.name_iframe_class)[0],this.win=new i.ExtWindow(this.iframe.el.contentWindow),this.pm=new o.default(window),this.pm.on(r.PM_PLAGIN,this.eventPM),this.sendPM({action:"init"})},t.prototype.install=function(e){this.main=e,e.EventInitComplite.on(this.init),e.EventRender.on(this.eventRender),this.iframe=new i.ExtElement(t.createIframe(this.setting.ServerUrl))},t.prototype.uninstall=function(t){this.extwin.win.document.body.removeChild(this.iframe.el),this.pm.off(r.PM_PLAGIN,this.eventPM),t.EventInitComplite.off(this.init),t.EventRender.off(this.eventRender),clearInterval(this.timer_resize)},t}();e.PopupPlagin=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=100,r=function(){function t(e,n,i){var r=this;this.update=function(e,n){void 0===e&&(e=r.config.comment_class),void 0===n&&(n=r.config.comment_render);var i=r.window.document.getElementsByClassName(e),s=t._getKeys(i);if(0!=s.urls.length||0!=s.identityes.length){var c=s.identityes.length>0?"&i="+s.identityes.slice(0,o).join("&i="):"",a=Math.max(0,o-s.identityes.length),u=s.urls.length>0?"&h="+s.urls.slice(0,a).join("&h="):"",l=[r.setting.ServerUrl,"/api/chat/countcomment?siteid=",r.setting.SiteId,c,u].join("");return fetch(l).then(function(t){return t.json()}).then(function(t){return t.data.hashas}).then(function(e){return t._onCountComment(e,s.elems,n),e}).catch(function(t){throw new Error("tc: server settings no load")})}},this.setting=e,this.config=n,this.window=i,this.config.comment_class&&this.update()}return t._getKeys=function(t){for(var e,n,o=[],r=[],s={},c=0;c<t.length;c++)n="",(e=t[c]).hasAttribute("data-identity")?(n=i.MD5(e.getAttribute("data-identity")),-1==r.indexOf(n)&&r.push(n)):e.hasAttribute("data-url")&&(n=i.Md5UrlWithoutHost(e.getAttribute("data-url")),-1==o.indexOf(n)&&o.push(n)),""!=n&&(s[n]=s[n]||[],s[n].push(e));return{elems:s,urls:o,identityes:r}},t._onCountComment=function(t,e,n){var i,o,r,s;for(o in t)if(i=t[o],e[o].length)for(r in e[o])(s=n.call(e[o][r],i))&&(e[o][r].textContent=s)},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,o=n(3),r=n(16),s=n(10);!function(t){t.chat_top="chat_top",t.comment_top="chat_top",t.comment_last="comment_last"}(i||(i={}));var c=function(){function t(t,e,n,i,r){this._setting=t,this._config=e,this._window=i,this._server=n,this._data=r;var s=document.getElementById(this._data.id);if(null==s)throw new Error("tc: element not found by id: "+this._data.id);this._iframe=new o.ExtElement(s.appendChild(this._createIfrmae(this._data)))}return t.prototype._createIfrmae=function(t){var e=this._window.document.createElement("iframe"),n={async:"async",scrolling:"no",src:this._setting.ServerUrl+"/widget/banner.html?t="+Math.round((new Date).getTime()/3e3).toString()+"#"+t.id,frameBorder:"0"};for(var i in n)e.setAttribute(i,n[i]);return o.SetStyle(e.style,{width:"100%"}),e},t.prototype.init=function(){r.default.send(this._iframe.el.contentWindow,{type:s.PM_BANNER_INIT,data:{init:this._data,server:this._server,config_lang:this._config.lang,config_theme:this._config.theme,setting:this._setting}})},t.prototype.resize=function(t){this._height!=t&&(this._height=t,this._iframe.el.style.height=this._height+"px")},t.prototype.destroy=function(){this._iframe.el.parentNode.removeChild(this._iframe.el)},t}(),a=function(){function t(t,e,n,i){var o=this;this._items={},this._count=0,this.create=function(t){return 0==o._count&&(o._pm=new r.default(o._window),o._pm.on(s.PM_BANNER_INIT,o._init),o._pm.on(s.PM_BANNER_RESIZE,o._resize)),o._items[t.id]=new c(o._setting,o._config,o._server,o._window,t),o._count++,o._items[t.id]},this.destroy=function(t){o._items[t]&&(o._items[t].destroy(),o._items[t]=null,o._count--),0==o._count&&(o._pm.off(s.PM_BANNER_INIT,o._init),o._pm.off(s.PM_BANNER_RESIZE,o._resize),o._pm=null)},this._init=function(t){o._items[t.id]&&o._items[t.id].init()},this._resize=function(t){o._items[t.id]&&o._items[t.id].resize(t.height)},this._setting=t,this._config=e,this._window=i,this._server=n}return Object.defineProperty(t.prototype,"items",{get:function(){return this._items},enumerable:!0,configurable:!0}),t}();e.MiniWidgetGroup=a}]);